<!DOCTYPE HTML>
<html>
<head>
 <meta charset="utf-8" /> 
    <title>Panda Music</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"> 	 
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!--   <link rel="stylesheet" href="css/master.css" type="text/css" media="screen" />-->
    <link rel="stylesheet" href="css/styles.css" /> 
    <link rel="stylesheet"  href="css/jquery.mobile-1.1.0.min.css" />
    
    <script type="text/javascript" charset="utf-8" src="cordova-2.0.0.js"></script>
   
   <!--  <script src="js/lawnchair/adaptors/LawnchairAdaptorHelpers.js" type="text/javascript" charset="utf-8"></script>  
    <script src="js/lawnchair/adaptors/DOMStorageAdaptor.js" type="text/javascript" charset="utf-8"></script>        
    <script src="js/lawnchair/adaptors/WebkitSQLiteAdaptor.js" type="text/javascript" charset="utf-8"></script>      
    <script src="js/lawnchair/Lawnchair.js" type="text/javascript" charset="utf-8"></script>     
    <script src="js/dsl.js" type="text/javascript" charset="utf-8"></script>     
    <script src="js/app.js" type="text/javascript" charset="utf-8"></script> -->
	 <script src="js/jquery-1.7.1.min.js"></script> 
    <script src="js/jquery.mobile-1.1.0.min.js"></script>
    
    <script type="text/javascript" charset="utf-8">

    
        my_media = null;
        mediaTimer = null;
    
         
        function playAudio(src) {
        	alert(src);
            if (my_media == null) {
                // Create Media object from src
                my_media = new Media(src, onSuccess, onError);
            }            	
            else{
               	 my_media.stop();
            	 clearInterval(mediaTimer);
                 mediaTimer = null;            	  
            	 my_media = new Media(src, onSuccess, onError);
            }
            	
            
             
            if (mediaTimer == null) {
                mediaTimer = setInterval(function() {
                    // get my_media position
                    my_media.getCurrentPosition(
                        // success callback
                        function(position) {
                            if (position > -1) {
                                setAudioPosition((position) + " sec");
                            }
                        },
                        // error callback
                        function(e) {
                            console.log("Error getting pos=" + e);
                            setAudioPosition("Error: " + e);
                        }
                    );
                }, 1000);
            }
            my_media.play();
        }

        // Pause audio
        // 
        function pauseAudio() {
            if (my_media) {
                my_media.pause();
            }
        }

        // Stop audio
        // 
        function stopAudio() {        
            if (my_media) {
                my_media.stop();
            }
            clearInterval(mediaTimer);
            mediaTimer = null;
        	alert('stoped');
        }

        // onSuccess Callback
        //
        function onSuccess() {
            console.log("playAudio():Audio Success");
        }

        // onError Callback 
        //
        function onError(error) {
            alert('code: '    + error.code    + '\n' + 
                  'message: ' + error.message + '\n');
        }

        // Set audio position
        // 
        function setAudioPosition(position) {
            document.getElementById('audio_position').innerHTML = position;
        }

        </script>
    
    <script type="text/javascript" charset="utf-8">

    // Wait for PhoneGap to load
    //
    document.addEventListener("deviceready", onDeviceReady, false);
    
  

    // Populate the database 
    //
    function populateDB(tx) {
        tx.executeSql('DROP TABLE IF EXISTS MUSIC');
        tx.executeSql('CREATE TABLE IF NOT EXISTS MUSIC (id unique, name)');
        tx.executeSql('INSERT INTO MUSIC (id, name) VALUES (1, "DK_rises.mp3")');
        tx.executeSql('INSERT INTO MUSIC (id, name) VALUES (2, "Exorcist.mp3")');
        tx.executeSql('INSERT INTO MUSIC (id, name) VALUES (3, "Galaxy.mp3")');
        tx.executeSql('INSERT INTO MUSIC (id, name) VALUES (4, "Halloween.mp3")');
        tx.executeSql('INSERT INTO MUSIC (id, name) VALUES (5, "Samsung.mp3")');
        tx.executeSql('INSERT INTO MUSIC (id, name) VALUES (6, "StepUp.mp3")');
    }

    // Query the database
    //
    function queryDB(tx) {
        tx.executeSql('SELECT * FROM MUSIC', [], querySuccess, errorCB);
    }

    
    function querySuccess(tx, results) {
        var len = results.rows.length;
        console.log("MUSIC table: " + len + " rows found.");
        for (var i=0; i<len; i++){        	
         console.log("Row = " + i + " ID = " + results.rows.item(i).id + " Data =  " + results.rows.item(i).name);
         mname= results.rows.item(i).name         
        //  $('#filelist').append("<li> <a href='#allDialogExample' onclick = playAudio('/android_asset/www/mp3/"+mname+");' >"+mname+"</a></li>");
         $('#filelist').append("<li> <a  href='#allDialogExample' onclick = fileName('"+mname+"');>"+mname+"</a></li>");
        }
    }

    // Transaction error callback
    //
    function errorCB(err) {
        console.log("Error processing SQL: "+err.code);
    }

    // Transaction success callback
    //
    function successCB() {
    	alert('created');
        var db = window.openDatabase("Database", "1.0", "PhoneGap Demo", 200000);
        db.transaction(queryDB, errorCB);
        
    }

    // PhoneGap is ready
    //
    function onDeviceReady() {
        var db = window.openDatabase("Database", "1.0", "PhoneGap Demo", 200000);
        db.transaction(populateDB, errorCB, successCB);
    }
	function fileName(m){
		$('#filename').text(m);
		$("#playbtn").html("<button data-theme='e' onclick =playAudio('/android_asset/www/mp3/"+m+"');>Play</button>");
	}
    </script>
    
 </head>
 
<body class="ui-mobile-viewport ui-overlay-c"> 
    
<div data-role="page"> 
   <div data-role="header" data-position="fixed"> 
     <h1 class="ui-title" role="heading" aria-level="1">Panda Music</h1>
   </div><!-- /header -->
   
    
     
 <div data-role="content"> 
  <ul data-role="listview" data-inset="true" > 	
    <li><a href="#listViews"> Search Music</a></li>   	   
  </ul> 
  
   <br />	
<br />
  </div><!-- /ui-body wrapper -->	
</div><!-- /page -->
	
<div data-role="page" id="listViews">     
	<div data-role="header" data-position="fixed">
	  <h1>List Example</h1>
	  <a href="#" data-rel="back" data-theme="a" >Back</a>
	</div><!-- /header --> 
  
	 <div data-role="content"> 
	   
	  <ul data-role="listview"  data-filter="true" data-filter-theme="c" data-filter-placeholder="Search Music..." class="ui-listview" id="filelist"> 

	  </ul>        
	  
	</div> 
</div>   

<div data-role="page" id="allDialogExample">   
	<div data-role="header" data-position="fixed">
	  <h1>List Example</h1>
	  <a href="#" data-rel="back" data-theme="a">Back</a>
	</div><!-- /header --> 
	
	<div>
	    <h3 id='filename'></h3>
	  <p id="audio_position">0.00</p>
	</div>
	
	<div id="playbtn" data-role="content"> 
	    
	</div>  
</div>

    
     
</html>
